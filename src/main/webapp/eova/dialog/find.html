<%layout("/eova/layout/default.html",{'title' : '查找数据'}){%>

<body class="easyui-layout">
	<%// title="快速查询" collapsed="true"%>
    <div id="layoutNorth" region="north"  split="true" style="height:40px;">
    <#query id="queryFindForm" items="${itemList}" />
    </div>
    <div data-options="region:'center',fit:false,border:false">
	    <%include("/eova/widget/find/toolbar.html"){}%>
	    <#grid id="findGrid" objectJson="${objectJson}" fieldsJson="${fieldsJson}" url="${action!}" />
    </div>
</body>
<script>

var object = JSON.parse('${objectJson}');

var init = function($dialog, $input, $inputcn) {
	alert(inputcn.attr('id'));
}

var selectData = function($dialog, findBox) {

    var grid = $('#findGrid');
    var row = grid.datagrid('getSelected');
    try{
    	// 有选中行
        var oldValue = findBox.$valuebox.val();
        var newValue = '';
        if (row) {
        	// 获取主键值(第一列)
            findBox.$valuebox.val(row[object.pk_name]);
        	// 获取翻译值(第二列)
            findBox.$textbox.val(row[object.cn]);
            newValue = findBox.$valuebox.val();
    	} else {
    		// 没选值，就清空
            findBox.$valuebox.val("");
            findBox.$textbox.val("");
            //$inputcn.addClass("validatebox-invalid");
            //$inputcn.validatebox('validate');
    	}
        // 值变更回调
        if (oldValue != newValue) {
            console.log(oldValue +'|'+newValue);
            findBox.options.onChange.call(findBox.$dom, oldValue, newValue);
        }
    }catch(err){
    	console.log("查找框validate异常:" + err);
    }finally{
    	// 关闭Dialog
    	$dialog.dialog('destroy');
    }
};

//绑定双击事件
$('#findGrid').datagrid({
	onDblClickRow : function(rowIndex, rowData){
		// 模拟点击确认
		parent.$('#find_ok').trigger('click');
	}
});
</script>
<%}%>
